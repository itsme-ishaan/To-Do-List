<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Task Manager</title>

<style>
:root {
    --primary: #111827;
    --accent: #2563eb;
    --bg: #f9fafb;
    --card: #ffffff;
    --border: #e5e7eb;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
    background: var(--bg);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

#login-container, #app-container {
    background: var(--card);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    width: 400px;
}

h2 {
    margin-bottom: 20px;
    color: var(--primary);
}

input, textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
    outline: none;
}

button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: var(--accent);
    color: white;
    cursor: pointer;
    margin-bottom: 10px;
    transition: 0.2s;
}

button:hover {
    opacity: 0.9;
}

.task {
    background: var(--bg);
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid var(--border);
}

.task-actions {
    display: flex;
    gap: 5px;
    margin-top: 5px;
}

.hidden {
    display: none;
}

.logout {
    background: #ef4444;
}
</style>
</head>
<body>

<div id="login-container">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Enter Username">
    <input type="password" id="password" placeholder="Enter Password">
    <button onclick="login()">Login</button>
</div>

<div id="app-container" class="hidden">
    <h2>Task Dashboard</h2>

    <input type="text" id="task-title" placeholder="Task Title">
    <textarea id="task-desc" placeholder="Task Description"></textarea>
    <button onclick="addTask()">Add Task</button>

    <div id="task-list"></div>

    <button class="logout" onclick="logout()">Logout</button>
</div>

<script>

let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

/* ---------- LOGIN ---------- */

function login() {
    const email = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    fetch("http://127.0.0.1:5000/login", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ email, password })
    })
    .then(res => res.json())
    .then(data => {
        if (data.user_id) {
            localStorage.setItem("user_id", data.user_id);

            document.getElementById("login-container").classList.add("hidden");
            document.getElementById("app-container").classList.remove("hidden");

            renderTasks();
        } else {
            alert("Invalid credentials");
        }
    })
    .catch(err => {
        console.error(err);
        alert("Server error");
    });
}

/* ---------- LOGOUT ---------- */

function logout() {
    localStorage.removeItem("user_id");
    document.getElementById("app-container").classList.add("hidden");
    document.getElementById("login-container").classList.remove("hidden");
}

/* ---------- ADD TASK ---------- */

function addTask() {
    const title = document.getElementById("task-title").value;
    const desc = document.getElementById("task-desc").value;

    if (!title) return alert("Task title required");

    const task = {
        id: Date.now(),
        title,
        desc,
        completed: false
    };

    tasks.push(task);
    localStorage.setItem("tasks", JSON.stringify(tasks));
    renderTasks();

    document.getElementById("task-title").value = "";
    document.getElementById("task-desc").value = "";
}

/* ---------- RENDER TASKS ---------- */

function renderTasks() {
    const list = document.getElementById("task-list");
    list.innerHTML = "";

    tasks.forEach(task => {
        const div = document.createElement("div");
        div.className = "task";

        div.innerHTML = `
            <strong>${task.title}</strong>
            <p>${task.desc}</p>
            <div class="task-actions">
                <button onclick="toggleTask(${task.id})">
                    ${task.completed ? "Undo" : "Complete"}
                </button>
                <button onclick="deleteTask(${task.id})" style="background:#ef4444;">
                    Delete
                </button>
            </div>
        `;

        list.appendChild(div);
    });
}

/* ---------- TOGGLE TASK ---------- */

function toggleTask(id) {
    tasks = tasks.map(task =>
        task.id === id ? {...task, completed: !task.completed} : task
    );
    localStorage.setItem("tasks", JSON.stringify(tasks));
    renderTasks();
}

/* ---------- DELETE TASK ---------- */

function deleteTask(id) {
    tasks = tasks.filter(task => task.id !== id);
    localStorage.setItem("tasks", JSON.stringify(tasks));
    renderTasks();
}

</script>

</body>
</html>
