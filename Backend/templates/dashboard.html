<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow | Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* COLORS & THEME VARIABLES */
        :root {
            /* DARK MODE (Default) */
            --bg-body: #09090b;
            --bg-card: #18181b; 
            --bg-sidebar: #0f0f12;
            --text-main: #ffffff;
            --text-muted: #a1a1aa;
            --border: rgba(255, 255, 255, 0.1);
            --primary: #6366f1;
            --accent: #14b8a6;
        }

        /* LIGHT MODE */
        [data-theme="light"] {
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --bg-sidebar: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
        }

        /* GREY / DIM MODE */
        [data-theme="grey"] {
            --bg-body: #e2e8f0;
            --bg-card: #f8fafc;
            --bg-sidebar: #e2e8f0;
            --text-main: #334155;
            --text-muted: #64748b;
            --border: #cbd5e1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg-body); color: var(--text-main); height: 100vh; overflow: hidden; transition: 0.3s; }
        
        .app-container { display: flex; height: 100vh; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border); padding: 25px; display: flex; flex-direction: column; }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-links { list-style: none; flex: 1; }
        .nav-btn { display: flex; align-items: center; gap: 12px; padding: 12px; margin-bottom: 5px; color: var(--text-muted); text-decoration: none; border-radius: 10px; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.2s, color 0.2s; cursor: pointer; }
        .nav-btn:hover { background: rgba(99, 102, 241, 0.1); color: var(--primary); transform: scale(1.05); }
        .nav-btn:active { transform: scale(1.1); }
        .nav-btn.active { background: rgba(99, 102, 241, 0.1); color: var(--primary); }

        .logout-btn { padding: 12px; background: rgba(244,63,94,0.1); color: #f43f5e; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%; text-align: center; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.2s; }
        .logout-btn:hover { transform: scale(1.05); background: rgba(244,63,94,0.2); }
        .logout-btn:active { transform: scale(1.1); }

        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .header-right { display: flex; gap: 15px; align-items: center; }
        
        .theme-toggle { width: 45px; height: 45px; border-radius: 50%; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-main); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem; transition: 0.3s; }
        .theme-toggle:hover { border-color: var(--primary); color: var(--primary); transform: rotate(20deg); }
        .add-btn { background: var(--primary); color: white; padding: 10px 20px; border-radius: 50px; border: none; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px; }

        /* VIEW SECTIONS */
        .view-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* GRID & CARDS */
        .bento-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; }
        .stat-card { display: flex; flex-direction: column; justify-content: center; }
        .stat-num { font-size: 2rem; font-weight: 700; }
        .stat-label { color: var(--text-muted); font-size: 0.9rem; }
        .timetable { grid-column: span 2; min-height: 250px; }
        .task-list { grid-column: span 2; min-height: 250px; }
        .task-item { background: var(--bg-body); padding: 12px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 3px solid var(--primary); }

        /* CALENDAR CSS */
        .calendar-container { background: var(--bg-card); border-radius: 16px; padding: 20px; border: 1px solid var(--border); margin-top: 20px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-header h2 { margin: 0; color: var(--primary); }
        .cal-btn { background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); padding: 5px 15px; border-radius: 8px; cursor: pointer; }
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; text-align: center; font-weight: bold; color: var(--text-muted); margin-bottom: 10px; }
        .calendar-dates { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .cal-date { padding: 15px; background: var(--bg-body); border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s; border: 1px solid transparent; }
        .cal-date:hover { border-color: var(--primary); }
        .cal-date.active-day { background: var(--primary); color: white; font-weight: bold; }
        .cal-date.empty { background: transparent; pointer-events: none; }

        /* MODAL */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter:blur(5px); z-index:1000; align-items:center; justify-content:center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--bg-card); padding: 30px; border-radius: 20px; width: 400px; border: 1px solid var(--border); }
        input, select { width: 100%; padding: 10px; margin: 5px 0 15px; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); border-radius: 8px; }
        .modal-btns { display: flex; gap: 10px; }
        .btn-sub { background: var(--primary); color: white; border: none; padding: 10px; flex: 1; border-radius: 8px; cursor: pointer; }
        .btn-can { background: transparent; border: 1px solid var(--border); color: var(--text-muted); padding: 10px; flex: 1; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-container">
    <aside class="sidebar">
        <div class="logo"><i class="fas fa-bolt"></i> TaskFlow</div>
        <ul class="nav-links">
            <li><a class="nav-btn active" id="btn-dashboard" onclick="switchView('dashboard')"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a class="nav-btn" id="btn-timetable" onclick="switchView('timetable')"><i class="fas fa-calendar"></i> Time Table</a></li>
            <li><a class="nav-btn" id="btn-tasks" onclick="switchView('tasks')"><i class="fas fa-tasks"></i> Tasks</a></li>
        </ul>
        <a href="/logout" style="text-decoration:none; margin-top:auto;">
            <button class="logout-btn">Logout</button>
        </a>
    </aside>

    <main class="main-content">
        <div class="header">
            <div>
                <h1>Hello, <span id="uName">{{ user_name }}</span>! üëã</h1>
                <p style="color: var(--text-muted);">Let's be productive.</p>
            </div>
            <div class="header-right">
                <button class="theme-toggle" onclick="toggleTheme()" title="Switch Theme">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
                <button class="add-btn" onclick="openModal()">+ Add Task</button>
            </div>
        </div>

        <div id="dashboard" class="view-section active">
            <div class="bento-grid">
                <div class="card stat-card"><div class="stat-num" id="total">0</div><div class="stat-label">Total Tasks</div></div>
                <div class="card stat-card"><div class="stat-num" style="color:#f59e0b" id="pending">0</div><div class="stat-label">Pending</div></div>
                <div class="card stat-card"><div class="stat-num" style="color:#10b981" id="completed">0</div><div class="stat-label">Completed</div></div>
                <div class="card stat-card"><div class="stat-num">92%</div><div class="stat-label">Attendance</div></div>

                <div class="card timetable">
                    <h3>üìÖ Today's Schedule</h3>
                    <div style="margin-top:15px; display:grid; gap:10px;">
                        <div style="background:var(--bg-body); padding:10px; border-radius:8px;">09:00 AM - Software Engineering</div>
                        <div style="background:var(--bg-body); padding:10px; border-radius:8px;">11:00 AM - Data Lab</div>
                    </div>
                </div>

                <div class="card task-list">
                    <h3>üìù Recent Tasks</h3>
                    <div id="taskListContainer" style="margin-top:10px;">Loading...</div>
                </div>
            </div>
        </div>

        <div id="timetable" class="view-section">
            <h2>Your Time Table & Calendar</h2>
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="cal-btn" onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                    <h2 id="monthYear">Month Year</h2>
                    <button class="cal-btn" onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-days">
                    <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                </div>
                <div class="calendar-dates" id="calendarDates">
                    </div>
            </div>
        </div>

        <div id="tasks" class="view-section">
            <h2>All Tasks Management</h2>
            <div class="card" style="margin-top: 20px;">
                <div id="fullTaskListContainer">Loading...</div>
            </div>
        </div>

    </main>
</div>

<div class="modal" id="taskModal">
    <div class="modal-content">
        <h3>Add New Task</h3>
        <form onsubmit="addTask(event)">
            <label>Title</label><input type="text" id="tTitle" required>
            <label>Date</label><input type="date" id="tDate" required>
            <label>Priority</label>
            <select id="tPriority"><option>Medium</option><option>High</option><option>Low</option></select>
            <div class="modal-btns">
                <button type="button" class="btn-can" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn-sub">Add</button>
            </div>
        </form>
    </div>
</div>

<script>
    // --- VIEW SWITCHER LOGIC ---
    function switchView(viewName) {
        // 1. Hide all views
        document.querySelectorAll('.view-section').forEach(view => {
            view.classList.remove('active');
        });
        
        // 2. Remove active class from all sidebar buttons
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        // 3. Show selected view and activate its button
        document.getElementById(viewName).classList.add('active');
        document.getElementById('btn-' + viewName).classList.add('active');

        // Render calendar if timetable is clicked
        if(viewName === 'timetable') renderCalendar();
    }

    // --- THEME SWITCHER ---
    function toggleTheme() {
        const html = document.documentElement;
        const icon = document.getElementById('themeIcon');
        const current = html.getAttribute('data-theme');
        
        if (current === 'dark') {
            html.setAttribute('data-theme', 'light');
            icon.className = 'fas fa-sun';
            localStorage.setItem('theme', 'light');
        } else if (current === 'light') {
            html.setAttribute('data-theme', 'grey');
            icon.className = 'fas fa-adjust';
            localStorage.setItem('theme', 'grey');
        } else {
            html.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-moon';
            localStorage.setItem('theme', 'dark');
        }
    }
    
    // Load Saved Theme
    const saved = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', saved);
    
    // Set correct icon on page load
    const themeIcon = document.getElementById('themeIcon');
    if (saved === 'dark') themeIcon.className = 'fas fa-moon';
    else if (saved === 'light') themeIcon.className = 'fas fa-sun';
    else if (saved === 'grey') themeIcon.className = 'fas fa-adjust';

    // --- CALENDAR LOGIC ---
    let currentDate = new Date();
    
    function renderCalendar() {
        const monthYear = document.getElementById('monthYear');
        const datesContainer = document.getElementById('calendarDates');
        
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        monthYear.innerText = `${months[month]} ${year}`;
        
        // Get first day of month and total days
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        let datesHTML = "";
        
        // Empty slots for days before 1st of month
        for(let i = 0; i < firstDay; i++) {
            datesHTML += `<div class="cal-date empty"></div>`;
        }
        
        // Actual days
        const today = new Date();
        for(let i = 1; i <= daysInMonth; i++) {
            let isToday = (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) ? "active-day" : "";
            datesHTML += `<div class="cal-date ${isToday}">${i}</div>`;
        }
        
        datesContainer.innerHTML = datesHTML;
    }

    function changeMonth(step) {
        currentDate.setMonth(currentDate.getMonth() + step);
        renderCalendar();
    }

    // --- TASK LOGIC ---
    window.onload = loadTasks;

    async function loadTasks() {
        try {
            // Fake Data for UI testing (Replace with your actual API later if needed)
            const tasks = [
                {id: 1, title: 'Python Class Attend', due_date: '2026-02-21', priority: 'High', status: 'Pending'},
                {id: 2, title: 'Submit Data Lab', due_date: '2026-02-22', priority: 'Medium', status: 'Pending'}
            ];
            /* // Uncomment this when backend is ready
            const res = await fetch('/api/tasks');
            const tasks = await res.json();
            */
            
            document.getElementById('total').innerText = tasks.length;
            document.getElementById('pending').innerText = tasks.filter(t=>t.status==='Pending').length;
            document.getElementById('completed').innerText = tasks.filter(t=>t.status==='Completed').length;

            const listContainer = document.getElementById('taskListContainer');
            const fullListContainer = document.getElementById('fullTaskListContainer');
            
            if(tasks.length === 0) { 
                listContainer.innerHTML = "<p>No tasks yet.</p>"; 
                fullListContainer.innerHTML = "<p>No tasks yet.</p>";
                return; 
            }

            const taskHTML = tasks.map(t => `
                <div class="task-item" style="border-left-color:${t.priority==='High'?'#f43f5e': t.priority==='Low'?'#10b981':'#f59e0b'}">
                    <div><b>${t.title}</b> <br><span style="font-size:0.8em; color:gray"><i class="fas fa-clock"></i> ${t.due_date} | Priority: ${t.priority}</span></div>
                    <button onclick="delTask(${t.id})" style="border:none; background:none; color:#f43f5e; cursor:pointer; padding:5px;"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');

            listContainer.innerHTML = taskHTML;
            fullListContainer.innerHTML = taskHTML; // Populating both Dashboard and Tasks views

        } catch(e) { console.log(e); }
    }

    function openModal() { document.getElementById('taskModal').classList.add('active'); }
    function closeModal() { document.getElementById('taskModal').classList.remove('active'); }

    async function addTask(e) {
        e.preventDefault();
        /* Uncomment when backend is ready
        await fetch('/api/tasks', {
            method:'POST', 
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({
                title: document.getElementById('tTitle').value,
                due_date: document.getElementById('tDate').value,
                priority: document.getElementById('tPriority').value
            })
        });
        */
        closeModal(); loadTasks();
    }

    async function delTask(id) {
        if(confirm('Delete this task?')) {
            // await fetch(`/api/tasks/${id}`, {method:'DELETE'}); // Uncomment for backend
            loadTasks();
        }
    }
</script>

</body>
</html>